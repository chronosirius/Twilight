{% extends "locked/base.html" %}

{% block styles %}
<style>
    span#channelname {
        right: 10%;
        top: 15%;
        color: var(--text-color);
        position: absolute;
        text-align: right;
    }

    div#sidebar-lim {
        text-align: center;
    }

    div#sidebar-lim::-webkit-scrollbar {
        display: none;
    }

    .channel {
        color: var(--text-color);
        width: 90%;
        text-decoration: none;
        margin-left: 5%;
        margin-right: 5%;
        line-height:200%;
        vertical-align:middle;
        border-radius: 5px;
    }

    .channel a.cname {
        overflow: hidden;
        white-space: nowrap;
        text-overflow: ellipsis;
    }

    .channel:hover {
        background-color: var(--tlv-el-color);
    }

    hr.vertical {
        transform: rotate(90deg);
    }

    {% if has_perm(perms, 32) %}

    .channel .settings {
        min-height: 100%;
        width:20%;
        justify-content: center;
        align-items: center;
        text-decoration: none;
    }

    .channel:hover .settings {
        display:flex;
    }

    .channel:not(:hover) .settings {
        display: none;
    }

    {% endif %}

    .channel .cname {
        color: var(--text-color);
        text-decoration: none;
        line-height: 200%;
        display:inline-flex;
        align-items: center;
        text-align: center;
        justify-content: left;
        width:80%;

    }

    .channel span.typesymbol {
        padding: 2%;
        vertical-align: middle;
    }

    #dropdown {
        display: none;
        z-index: 100;
        position: absolute;
        width: 97.5%;
        margin-left:1.25%;
        margin-right:1.25%;
        background-color: var(--spec-el-color);
        color: var(--text-color);
        height: fit-content;
        top: 100%;
        box-shadow: 0px 1px 3px black;
        border-radius: 5px;
    }

    #dropdown p:hover {
        background-color: var(--thlv-el-color);
    }

    #dropdown p:first-child {
        margin-top: 5%;
        margin-bottom: 0;
        width: 90%;
        margin-left:5%;
        margin-right: 5%;
    }

    #dropdown p:last-child {
        margin-top: 0;
        margin-bottom: 5%;
        width: 90%;
        margin-left: 5%;
        margin-right: 5%;
    }

    #dropdown p:not(:first-child):not(:last-child) {
        margin-top: 0;
        margin-bottom:0;
        width: 90%;
        margin-left: 5%;
        margin-right: 5%;
    }

    #serverheader {
        min-height: 100%;
        bottom:0;
        top:0;
        width: 20%;
        text-align: center;
        position:absolute;
    }

    #serverheader h2 {
        color: var(--text-color);
        text-align: center;
        min-height:100%;
        margin:0;
    }
    #serverheader h2:hover {
        background-color:var(--spec-el-color);
    }

    .flash {
        animation: flash 1s;
    }

    .zoomin {
        animation: zoomin 1s;
    }
</style>
{% endblock %}

{% block topbar %}
<div id='serverheader'>
    <h2>{{ server['name'] }}</h2>
    <div id='dropdown'>
            <p onclick='privacy()'>Privacy</p>
            <br>
            <p onclick='invite()'>Invite People</p>
            {% if has_perm(perms, 64) %}
            <br>
            <p onclick="redirect('/servers/{{ server['id'] }}/settings')">Server Settings</p>
            {% endif %}
    </div>
</div>
{% endblock %}

{% block sidebar %}
<div class="channel" style="margin-top:1.25%;"><div style='display: flex;'>
    <a href="/servers/{{ server['id'] }}/home" class="cname" style="width:100%;"><span class='material-symbols-outlined typesymbol'>house</span>Home</a>
</div></div>
<div class="channel"><div style="display: flex;">
    <a href="/servers/{{ server['id'] }}/members" class="cname" style="width:100%;"><span class="material-symbols-outlined typesymbol">group</span>Members</a>
</div></div>
<hr style="width: 100%;">
{% set k = namespace(cat=None) %}
{% for category, channels in server['channels'].items() %}
    {% if k.cat != category and category != 'ungrouped' %}
    <hr>
    {% endif %}
    {% set k.cat = category %}
    {% for channel in channels.values() %}
    <div class="channel">
        <div style="display:flex;"><a href='/servers/{{ server["id"] }}/channels/{{ channel["id"] }}' class="cname"><span class='material-symbols-outlined typesymbol'>{{ channel.material_symbol }}</span>{{ channel.name }}</a>
        {% if has_perm(perms, 32) %}
        <a href="/servers/{{ server['id'] }}/channels/{{ channel['id'] }}/settings" class="settings"><span class='material-symbols-outlined' style="color: var(--disc-color); padding:6%; font-size:20px; margin-top:5%;">settings</span></a>
        </div>
        {% endif %}
    </div>
    {% endfor %}
{% endfor %}
{% endblock %}

{% block scripts %}
<script async="false">
    dropdown_open = false
    document.getElementById('serverheader').addEventListener('click', function() {
        document.getElementById('dropdown').style.display = (!dropdown_open ? "block": "none")
        dropdown_open = !dropdown_open
    })
    document.getElementById('dropdown').addEventListener('click', function(e) {
        e.stopPropagation()
    })
    document.body.addEventListener('click', function(e) {
        k = document.getElementById('dropdown')
        l = document.getElementById('serverheader')
        if (e.target.id != k.id && e.target.parentNode.id != k.id && e.target.id != l.id && e.target.parentNode.id != l.id && dropdown_open) {
            k.style.display = "none"
            dropdown_open = !dropdown_open
        }
    })
</script>
{% endblock %}